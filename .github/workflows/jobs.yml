on: 
  push: 
    branches:
      - Development

jobs: 
  build: 
    runs-on: ubuntu-latest

    steps: 
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with: 
        java-version: 17
        distribution: 'temurin'
        cache: 'gradle'

    - name: Make Gradlew Executable
      run: |
          chmod +x ./gradlew

    - name: Build with Gradle
      run: ./gradlew build

    - name: Run unit tests
      run: ./gradlew test

  docker: 
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Docker
        uses: docker/setup-docker@v4
      - name: Build image
        run: docker build -t ghcr.io/umm-a/singlaslant-github-actions:Development -f Dockerfile .
      - name: Push image
        run: docker push ghcr.io/umm-a/singlaslant-github-actions:Development
    #- name: Build and push Docker image
     # working-directory: SinglaSlant-GitHub-Actions
      #run: |
        #docker build . --file Dockerfile --tag singlaslant-github-actions:$(date +%s)
        #docker push ghcr.io/umm-a/singlaslant-github-actions:Development

  fake-deployment: 
    runs-on: ubuntu-latest
    needs: docker

    steps:
    - name: Fake Deployment
      run: echo "ghcr.io/umm-a/singlaslant-github-actions:Development"
